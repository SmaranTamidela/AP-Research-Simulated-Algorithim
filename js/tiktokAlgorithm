// List of videos
const tiktokVideos = [
  "animaltiktok.mp4",
  "arttiktok.mp4",
  "basketballtiktok.mp4",
  "boxingtiktok.mp4",
  "drivingtiktok.mp4",
  "earthtiktok.mp4",
  "foodtiktok.mp4",
  "gamingtiktok.mp4",
  "knittingtiktok.mp4",
  "partytiktok.mp4",
  "sciencetiktok.mp4",
  "singingtiktok.mp4",
  "soccertiktok.mp4",
  "technologytiktok.mp4",
  "traveltiktok.mp4"
];

// Recommendation mapping
const recommendationMap = {
  earth: { high: ["science", "technology"], moderate: ["travel", "animal"], low: ["art", "knitting"] },
  food: { high: ["travel", "party"], moderate: ["science", "technology"], low: ["knitting", "art"] },
  soccer: { high: ["basketball", "boxing"], moderate: ["boxing", "driving"], low: ["travel", "earth"] },
  travel: { high: ["food", "singing"], moderate: ["earth", "animal"], low: ["science", "technology"] },
  knitting: { high: ["art", "technology"], moderate: ["food", "travel"], low: ["singing", "knitting"] },
  science: { high: ["technology", "earth"], moderate: ["animal", "food"], low: ["soccer", "basketball"] },
  basketball: { high: ["soccer", "boxing"], moderate: ["boxing", "driving"], low: ["knitting", "art"] },
  boxing: { high: ["soccer", "basketball"], moderate: ["driving", "soccer"], low: ["travel", "earth"] },
  driving: { high: ["boxing", "soccer"], moderate: ["travel", "food"], low: ["technology", "science"] },
  animal: { high: ["earth", "science"], moderate: ["travel", "food"], low: ["knitting", "art"] },
  technology: { high: ["science", "earth"], moderate: ["art", "knitting"], low: ["driving", "boxing"] },
  art: { high: ["knitting", "technology"], moderate: ["food", "travel"], low: ["singing", "art"] },
  singing: { high: ["travel", "food"], moderate: ["art", "knitting"], low: ["science", "technology"] },
  gaming: { high: ["party", "soccer"], moderate: ["technology", "science"], low: ["driving", "boxing"] },
  party: { high: ["gaming", "singing"], moderate: ["food", "travel"], low: ["knitting", "art"] }
};

// Pick random video to start
function getRandomVideo() {
  return tiktokVideos[Math.floor(Math.random() * tiktokVideos.length)];
}

// Determine engagement
function getEngagementLevel(videoElement) {
  const watchedPercent = (videoElement.currentTime / videoElement.duration) * 100;
  if (watchedPercent > 75 || favorited) return "high";
  if (watchedPercent > 25 || liked) return "moderate";
  return "low";
}

// Get next video
function getNextVideo(currentVideo, engagementLevel) {
  const baseName = currentVideo.replace("tiktok.mp4", "");
  const nextCategories = recommendationMap[baseName][engagementLevel];
  
  for (let cat of nextCategories) {
    const nextVid = tiktokVideos.find(v => v.includes(cat));
    if (nextVid) return nextVid;
  }
  return tiktokVideos[Math.floor(Math.random() * tiktokVideos.length)];
}

// Grab elements
const videoContainer = document.querySelector(".video-container video");
const likeBtn = document.getElementById("like");
const favoriteBtn = document.getElementById("favorite");

// Track engagement buttons
let liked = false;
let favorited = false;

// Toggle buttons
likeBtn.addEventListener("click", () => {
  liked = !liked;
  likeBtn.classList.toggle("active");
});

favoriteBtn.addEventListener("click", () => {
  favorited = !favorited;
  favoriteBtn.classList.toggle("active");
});

// Load random starting video
let currentVideo = getRandomVideo();
videoContainer.src = "../videos/" + currentVideo;

// Play next video on end
videoContainer.addEventListener("ended", () => {
  const engagement = getEngagementLevel(videoContainer);
  const nextVideo = getNextVideo(currentVideo, engagement);
  currentVideo = nextVideo;
  videoContainer.src = "../videos/" + nextVideo;
  videoContainer.play();
});
